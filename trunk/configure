#!/bin/bash

generateSpindown() {
  echo -n "Generating spindown init script..."
  echo -n "" > spindown
  CURDIR=`pwd`

  while read line; do
  
    if [ "${line:0:13}" == "SPINDOWNPATH=" ]; then
    
      echo -n "SPINDOWNPATH=" >> spindown
      if [ "$1" == "debug" ]; then
        echo "\"$CURDIR/spindownd\"" >> spindown
      else
        echo "\"/sbin/spindownd\""  >> spindown
      fi
      
    else if [ "${line:0:9}" == "LOCKFILE=" ]; then
      
      echo -n "LOCKFILE=" >> spindown
      if [ "$1" == "debug" ]; then
        echo "\"$CURDIR/spindown.lock\"" >> spindown
      else
        echo "\"/var/lock/spindown.lock\"" >> spindown
      fi
      
    else if [ "${line:0:9}" == "FIFOPATH=" ]; then
      
      echo -n "FIFOPATH=" >> spindown
      if [ "$1" == "debug" ]; then
        echo "\"$CURDIR/spindown.fifo\"" >> spindown
      else
        echo "\"/var/run/spindown.fifo\"" >> spindown
      fi
      
    else if [ "${line:0:8}" == "PIDPATH=" ]; then
      
      echo -n "PIDPATH=" >> spindown
      if [ "$1" == "debug" ]; then
        echo "\"$CURDIR/spindown.pid\"" >> spindown
      else
        echo "\"/var/run/spindown.pid\"" >> spindown
      fi
      
    else if [ "${line:0:8}" == "CONFPATH=" ]; then
      
      echo -n "CONFPATH=" >> spindown
      if [ "$1" == "debug" ]; then
        echo "\"$CURDIR/spindown.conf\"" >> spindown
      else
        echo "\"/etc/spindown.conf\"" >> spindown
      fi
      
    else
      echo $line >> spindown
    fi fi fi fi fi
  
  done < scripts/spindown
  
  chmod +x spindown
  
  echo -e "\t\t\t\tdone."
}

#is sg_start present?
if ! command -v sg_start &>/dev/null
then
        echo "The command sg_start was not found, but is required."
        exit 0
fi

generateSpindown $1